# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

## ‚úÖ –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

1. **Docker –∏ Docker Compose** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
2. **Nginx** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ reverse proxy —Å HTTPS (—Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
3. **GitHub Actions** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ push –≤ main
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –ë–î** - –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
5. **Healthcheck** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç** - –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–µ–ø–ª–æ—è
7. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ cron

## üìã –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ GitHub Secrets

–°–º. [GITHUB_SECRETS_SETUP.md](./GITHUB_SECRETS_SETUP.md)

### 2. –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤:
- –°–¥–µ–ª–∞–π—Ç–µ push –≤ main –≤–µ—Ç–∫—É
- –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ workflow –≤—Ä—É—á–Ω—É—é –≤ GitHub Actions

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
cd /root/bx-tg-notify
docker compose --profile production ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose --profile production logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl https://shebo.h512.ru/health
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞:

```bash
cd /root/bx-tg-notify
ENV_FILE=.production.env docker compose --profile production up -d
ENV_FILE=.production.env docker compose --profile production down
```

### –õ–æ–≥–∏:

```bash
# –í—Å–µ –ª–æ–≥–∏
docker compose --profile production logs -f

# –¢–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
docker compose --profile production logs -f app

# –¢–æ–ª—å–∫–æ MySQL
docker compose --profile production logs -f mysql
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
docker compose --profile production restart
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞:

```bash
ENV_FILE=.production.env docker compose --profile production up -d --build
```

## üì¶ –ë—ç–∫–∞–ø—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã:

- –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
- –•—Ä–∞–Ω—è—Ç—Å—è –≤ `/root/backups/db/`
- –•—Ä–∞–Ω—è—Ç—Å—è 7 –¥–Ω–µ–π
- –õ–æ–≥–∏: `/var/log/db-backup.log`

### –†—É—á–Ω–æ–π –±—ç–∫–∞–ø:

```bash
/root/bx-tg-notify/scripts/backup-db.sh
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞:

```bash
gunzip < /root/backups/db/backup_YYYYMMDD_HHMMSS.sql.gz | \
  docker exec -i nest_mysql mysql -u shebo -p shebo
```

## üîí SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∑–∞ 30 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- –õ–æ–≥–∏: `/var/log/ssl-renewal.log`

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:

```bash
/root/bx-tg-notify/scripts/renew-ssl-cert.sh
```

## üåê Nginx

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

- –§–∞–π–ª: `/etc/nginx/sites-available/shebo.h512.ru`
- SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã: `/etc/nginx/ssl/`

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
systemctl reload nginx

# –õ–æ–≥–∏
tail -f /var/log/nginx/shebo.h512.ru.*.log
```

## üîÑ –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ—Å–ª–∏:
- Healthcheck –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`

–û—Ç–∫–∞—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏
docker stats

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h
du -sh /root/backups/db/
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:

```bash
# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker compose logs app --tail=100

# –õ–æ–≥–∏ nginx
tail -100 /var/log/nginx/shebo.h512.ru.error.log

# –õ–æ–≥–∏ –±—ç–∫–∞–ø–æ–≤
tail -100 /var/log/db-backup.log
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose logs app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .production.env

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ MySQL –∑–∞–ø—É—â–µ–Ω
docker compose ps mysql
```

### Nginx –Ω–µ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ 3000
netstat -tlnp | grep 3000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx
tail -f /var/log/nginx/shebo.h512.ru.error.log
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±—ç–∫–∞–ø–∞–º–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MySQL –∑–∞–ø—É—â–µ–Ω
docker ps | grep mysql

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–∞–ø –≤—Ä—É—á–Ω—É—é
/root/bx-tg-notify/scripts/backup-db.sh

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -f /var/log/db-backup.log
```

## üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

- `docker-compose.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
- `.production.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `.github/workflows/deploy.yml` - GitHub Actions workflow
- `scripts/backup-db.sh` - —Å–∫—Ä–∏–ø—Ç –±—ç–∫–∞–ø–∞ –ë–î
- `scripts/renew-ssl-cert.sh` - —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SSL
- `/etc/nginx/sites-available/shebo.h512.ru` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ HTTPS —á–µ—Ä–µ–∑ nginx
- ‚úÖ MySQL –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ localhost
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ nginx
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –≤ GitHub Secrets
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ Fail2ban –∑–∞—â–∏—â–∞–µ—Ç SSH
- ‚úÖ UFW —Ñ–∞–π–µ—Ä–≤–æ–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω

