# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

## üìã –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã

–î–ª—è —Ä–∞–±–æ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ GitHub:

### 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

- –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/temakulakov/bx-tg-notify
- Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret

### 2. –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

#### SSH –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É:

- **`SSH_PRIVATE_KEY`** - –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
  - –°–æ–∑–¥–∞–π—Ç–µ –∫–ª—é—á: `ssh-keygen -t ed25519 -f ~/.ssh/github_deploy -N ""`
  - –î–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä: `cat ~/.ssh/github_deploy.pub >> ~/.ssh/authorized_keys`
  - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á: `cat ~/.ssh/github_deploy` (–≤–µ—Å—å –≤—ã–≤–æ–¥)

- **`SERVER_HOST`** - IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω —Å–µ—Ä–≤–µ—Ä–∞
  - –ó–Ω–∞—á–µ–Ω–∏–µ: IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `135.125.xxx.xxx`)

- **`SERVER_USER`** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è SSH
  - –ó–Ω–∞—á–µ–Ω–∏–µ: `root`

- **`SSH_PORT`** - –ü–æ—Ä—Ç SSH –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
  - –ó–Ω–∞—á–µ–Ω–∏–µ: –ø–æ—Ä—Ç SSH –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `777` –∏–ª–∏ `22`)

- **`SSH_PASSPHRASE`** - –ü–∞—Ä–æ–ª—å–Ω–∞—è —Ñ—Ä–∞–∑–∞ –¥–ª—è SSH –∫–ª—é—á–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
  - –ó–Ω–∞—á–µ–Ω–∏–µ: –ø–∞—Ä–æ–ª—å–Ω–∞—è —Ñ—Ä–∞–∑–∞ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –∫–ª—é—á –±–µ–∑ –ø–∞—Ä–æ–ª—è

- **`APP_DIR`** - –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  - –ó–Ω–∞—á–µ–Ω–∏–µ: `/root/bx-tg-notify`

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

- **`DB_USER`** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MySQL
  - –ó–Ω–∞—á–µ–Ω–∏–µ: `shebo` (–∏–ª–∏ –≤–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

- **`DB_PASS`** - –ü–∞—Ä–æ–ª—å MySQL
  - –ó–Ω–∞—á–µ–Ω–∏–µ: –≤–∞—à –ø–∞—Ä–æ–ª—å MySQL

- **`DB_NAME`** - –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –ó–Ω–∞—á–µ–Ω–∏–µ: `shebo` (–∏–ª–∏ –≤–∞—à–µ –∏–º—è –ë–î)

#### Bitrix24:

- **`BX24_OUTGOING_TOKEN`** - Outgoing webhook token
  - –ó–Ω–∞—á–µ–Ω–∏–µ: –≤–∞—à —Ç–æ–∫–µ–Ω –∏–∑ Bitrix24

- **`BX24_INCOMING_TOKEN`** - Incoming webhook token
  - –ó–Ω–∞—á–µ–Ω–∏–µ: –≤–∞—à —Ç–æ–∫–µ–Ω –∏–∑ Bitrix24

- **`BX24_INCOMING_USER`** - Incoming webhook user ID
  - –ó–Ω–∞—á–µ–Ω–∏–µ: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `777`)

- **`BX24_DOMAIN`** - –î–æ–º–µ–Ω Bitrix24
  - –ó–Ω–∞—á–µ–Ω–∏–µ: `https://your-domain.bitrix24.ru`

#### Telegram:

- **`TELEGRAM_BOT_TOKEN`** - –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
  - –ó–Ω–∞—á–µ–Ω–∏–µ: —Ç–æ–∫–µ–Ω –æ—Ç @BotFather

#### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

- **`APP_URL`** - URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è Telegram Web App
  - –ó–Ω–∞—á–µ–Ω–∏–µ: `https://your-domain.com` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTTPS)

---

## üîë –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–∞ –¥–ª—è –¥–µ–ø–ª–æ—è

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ SSH –∫–ª—é—á
ssh-keygen -t ed25519 -f ~/.ssh/github_deploy -N ""

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/github_deploy.pub root@YOUR_SERVER_IP

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
cat ~/.ssh/github_deploy.pub | ssh root@YOUR_SERVER_IP "cat >> ~/.ssh/authorized_keys"

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è GitHub Secrets
cat ~/.ssh/github_deploy
```

**–í–∞–∂–Ω–æ:** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã `cat ~/.ssh/github_deploy` (–≤–∫–ª—é—á–∞—è `-----BEGIN OPENSSH PRIVATE KEY-----` –∏ `-----END OPENSSH PRIVATE KEY-----`)

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ workflow –≤—Ä—É—á–Ω—É—é (Run workflow)
3. –ò–ª–∏ —Å–¥–µ–ª–∞–π—Ç–µ push –≤ main –≤–µ—Ç–∫—É

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ GitHub Secrets (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã)
- ‚úÖ SSH –∫–ª—é—á —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–µ–ø–ª–æ—è (–º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–∞–≤–∞)
- ‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∫–æ–¥
- ‚úÖ `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è

---

## üìù –ü—Ä–∏–º–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è SSH –∫–ª—é—á–∞

–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å SSH –∫–ª—é—á —Ç–æ–ª—å–∫–æ –¥–µ–ø–ª–æ–µ–º:

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ `~/.ssh/authorized_keys`:

```
command="cd /root/bx-tg-notify && git pull",no-port-forwarding,no-X11-forwarding,no-agent-forwarding ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAI... github_deploy
```

---

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–æ SSH:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –≤ `~/.ssh/authorized_keys`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞: `chmod 600 ~/.ssh/authorized_keys`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ SSH –¥–æ—Å—Ç—É–ø–µ–Ω: `ssh root@YOUR_SERVER_IP`

### –û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: `docker compose logs`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω: `systemctl status docker`

### –û—à–∏–±–∫–∞ healthcheck:

- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç endpoint `/health`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs app`

